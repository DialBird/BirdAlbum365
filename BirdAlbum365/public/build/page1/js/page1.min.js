"use strict";function PlaneCircleGenerator(){this.scene=WebPage.Canvas.scene,this.birdSpriteImg=WebPage.Preload.birdSpriteImg,this.birdSpriteJSON=WebPage.Preload.birdSpriteJSON,this.birdNamesJSON=WebPage.Preload.birdNamesJSON,this.birdNamesNum=this.birdNamesJSON.length,this.planeNum=12}function preloadData(){var e=[{id:"birdSpriteImg",src:"build/birdImages/birdSprite.min.jpg"},{id:"birdSpriteJSON",src:"json/birdSprite.json"},{id:"birdNamesJSON",src:"json/birdNames.json"}],a=new createjs.LoadQueue(!1);a.addEventListener("fileload",handleFileload),a.addEventListener("progress",handleProgress),a.loadManifest(e)}function handleFileload(e){var a=e.item.type;switch(a){case"image":"birdSpriteImg"===e.item.id&&(WebPage.Preload.birdSpriteImg=e.result);break;case"json":"birdSpriteJSON"===e.item.id&&(WebPage.Preload.birdSpriteJSON=e.result),"birdNamesJSON"===e.item.id&&(WebPage.Preload.birdNamesJSON=e.result)}}function handleProgress(e){var a=100*e.progress;$(".header__insideLoadingBar").css("width",a+"%"),100===a&&($(".header__loadingBlock").addClass("js-hide"),setTimeout(init,1e3))}function init(){!function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e}();var e=$(window).innerWidth()<=1280?1280:$(window).innerWidth(),a=8*e/13,i=new THREE.WebGLRenderer({alpha:!0});i.setSize(e,a),i.shadowMap.enabled=!0,$("#canvas").append(i.domElement);var t=new THREE.Scene,n=new THREE.PerspectiveCamera(60,e/a,1,1e3);n.position.set(0,0,0),n.lookAt(new THREE.Vector3(1,0,0));var r=new THREE.DirectionalLight("#a3a3a3");r.position.set(-100,0,0),t.add(r);var o=new THREE.AmbientLight("#808080");t.add(o),WebPage.Canvas.scene=t,WebPage.Canvas.camera=n,WebPage.Canvas.renderer=i,main(),function s(){requestAnimationFrame(s),i.render(t,n)}()}function main(){function e(){$(".header__inner").addClass("js-show"),setTimeout(a,500)}function a(){function e(){i=!i,a.generate(i,200),setTimeout(e,2e3)}var a=new PlaneCircleGenerator,i=!1;a.generate(!1,170),a.generate(!0,140),a.generate(!1,110),a.generate(!0,80),a.generate(!1,50),a.generate(!0,20),e()}function i(e){if(null!==WebPage.Canvas.camera){var a=WebPage.Canvas.camera,i=e>=1200?-90:-(90*e/1200),t=i*Math.PI/180,n=Math.cos(t),r=Math.sin(t);a.lookAt(new THREE.Vector3(n,r,0))}}e(),$(window).on("resize",function(){var e=$(window).innerWidth()<=1280?1280:$(window).innerWidth(),a=WebPage.Canvas.renderer;a.setSize(e,8*e/13)}),function(){$(".section2__heading").load("img/svg/section2Heading.svg svg")}(),$(".footer__button").on("click",function(){location.href=$(this).attr("data-url")}),console.log(s),$(window).on("scroll",function(){var e=$(window).scrollTop();i(e),$(".calcTop").text(e),$(".header__inner").css("top",324-e)})}var WebPage={Preload:{birdSpriteImg:"",birdSpriteJSON:"",birdNamesJSON:""},Canvas:{scene:"",camera:"",renderer:""}},i;PlaneCircleGenerator.prototype={generate:function(e,a){var i=this.createPlaneCircle();this.startAnimation(i,e,a)},createPlaneCircle:function(){var e=new THREE.CubeGeometry(0,0),a=new THREE.MeshPhongMaterial({opacity:0,transparent:!0}),i=new THREE.Mesh(e,a);this.scene.add(i);var t,n=this.planeNum;for(t=0;n>t;t++){var r=new THREE.CylinderGeometry(80,80,20,64,1,!0,30*t*Math.PI/180,25*Math.PI/180),o=this.getTexture(),s=new THREE.MeshPhongMaterial({map:o,side:THREE.DoubleSide,opacity:0,transparent:!0}),d=new THREE.Mesh(r,s);d.rotation.set(0,0,-90*Math.PI/180),i.add(d)}return i},getTexture:function(){var e=Math.floor(Math.random()*this.birdNamesNum),a=this.birdNamesJSON[e],i=this.birdSpriteJSON[a],t=this.birdSpriteImg,n=i.x,r=i.y,o=i.width,s=i.height,d=document.createElement("canvas"),c=d.getContext("2d"),m=256;d.width=d.height=m,c.drawImage(t,n,r,o,s,0,0,m,m);var l=new THREE.Texture(d);return l.needsUpdate=!0,l},startAnimation:function(e,a,i){function t(){o.position.x=m.posX,o.rotation.x=m.rotX,o.traverse(function(e){if(e.material){var a=self.opacity>=1?1:m.opacity;e.material.opacity=a}})}function n(){o.traverse(function(e){e.material&&(r.remove(e),e.geometry.dispose(),e.material.dispose())}),r.remove(o),o.geometry.dispose(),o.material.dispose()}var r=this.scene,o=e,s=a?Math.PI:-1*Math.PI,d=i,c=d-300,m={posX:d,rotX:0,opacity:0};TweenLite.to(m,30,{posX:c,rotX:s,opacity:10,onUpdate:t,onComplete:n})}},preloadData();